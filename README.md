# Comparing Moral Values in Western English-speaking societies and LLMs with Word Associations

## Overview
This repository contains the prompts, code, and data for Llama's word associations used in the paper *Comparing Moral Values in Western English-Speaking Societies and LLMs Using Word Associations*. (Add link after publish)

---

## Folder: framework_construction

This folder contains code related to generating Llama responses, building graphs, and propagating moral information. Hereâ€™s a breakdown of the files in this folder:

| File       | Description                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------|
| `produce.py`         | This file is used to create Llama's associations. It contains the prompting and output generation code. To run this file, you need to replace line 11 with your own Hugging Face token.           |
| `getMoralValue.txt`| This file builds a graph based on associations and propagates moral information to the rest of the words. The results are stored to avoid repeated computations.                   |

## Folder: data
This folder contains the necessary data for framework construction and experiment execution.
| File       | Description                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------|
| `cue.txt`         | This file contains all the cue words used in the experiments for humans and LLMs.       |
| `emfd_scoring.csv`| This file is the Extended Moral Foundation Dictionary, which records words' moral information collected through crowd-sourcing.                   |
| `human_association.json`| This file contains processed human word associations from the Small World of Words project. The key is the cue word, and the value is a dictionary where the key is a response and the value is the frequency                  |
| `llama_2.1_association.json`| This file contains word associations for LLaMA. Similar to human associations, this file is a nested dictionary where the outer key represents the cue word, and the corresponding value is an inner dictionary. The inner dictionary maps associated words (keys) to their frequencies (values).               |
| `llama_2.1.json`| If you want to download the original data collection, please visit [this link](https://unimelbcloud-my.sharepoint.com/:u:/g/personal/chaoyix_student_unimelb_edu_au/EaqA4vmoGQ5Is0f3pAU9UhQBQB2zM14Ux0K9g4zc4no49Q). The key represents the cue words, and the value consists of responses collected sequentially in a three-word manner.                    |
| `human_moral.json / llama_2.1_moral.json`         | These two files contain moral information for all cues for LLaMA and humans, respectively. The two files can be generated by running `getMoralValue.py`.       |
| `mag_words.json`| This file contains the words used for comparison between MAG and GMN.          |
| `selected_words.json`| This file contains 93 randomly selected verbs, adjectives, and nouns from the MFD.                |

## File: experiments.py
This file contains the key experiments from the paper. Run `-h` for more information about the included experiments.

## Prerequisites

Before running the scripts, make sure to install the required Python packages. Below is a list of all dependencies:

- `numpy`
- `pandas`
- `tqdm`
- `collections`
- `torch`
- `transformers`
- `huggingface_hub`
- `gensim`
- `scipy`
- `scipy.stats`
- `matplotlib`

### Installation

To install the required Python packages, run:

```bash
pip install -r requirements.txt
```

## Instruction
1. **Produce LLaMA Associations**:
   - Run `produce.py` to generate the files `llama_2.1.json` and `llama_2.1_association.json`.
   - **Note**: This process requires significant computational power and is not recommended unless necessary.

2. **Generate Moral Information**:
   - Run `getMoralValue.py` to compute moral information based on human and LLM word associations.
   - The script will produce two files:
     - `human_moral.json`
     - `llama_2.1_moral.json`
   - These files will be saved in the `data` folder.

3. **Run Key Experiments**:
   - Perform key experiments described in the paper by running `experiments.py`.
   - For more details about the available experiments, use the following command:
     ```bash
     python experiments.py -h
     ```