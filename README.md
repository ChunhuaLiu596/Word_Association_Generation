# Comparing Moral Values in Western English-speaking societies and LLMs with Word Associations

## Overview
This repository contains the prompts, code, and data for Llama's word associations used in the paper *Comparing Moral Values in Western English-Speaking Societies and LLMs Using Word Associations*. (Add link after publish)

---

## Folder: framework_construction

This folder contains code related to generating Llama responses, building graphs, and propagating moral information. Hereâ€™s a breakdown of the files in this folder:

| File       | Description                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------|
| `produce.py`         | This file is used to create Llama's associations. It contains the prompting and output generation code. To run this file, you need to replace line 11 with your own Hugging Face token.           |
| `getMoralValue.py`| This file builds a graph based on associations and propagates moral information to the rest of the words. The results are stored to avoid repeated computations.                   |

## Folder: data
This folder contains the necessary data for framework construction and experiment execution.
| File       | Description                                                                                  |
|--------------------|---------------------------------------------------------------------------------------------|
| `cue.txt`         | This file contains all the cue words used in the experiments for humans and LLMs.       |
| `emfd_scoring.csv`| This file can be downloaded from [emfd](https://github.com/medianeuroscience/emfd). Please save it to the data folder.                  |
| `human_association.json`| This file can be created by running getHumanAssociation.py. Before running it, you need to download the English SWOW dataset from [SWOW Project](https://smallworldofwords.org/en/project/research). Save the downloaded file, named `SWOW-EN.R100.csv`, to the data folder. This code references the previous work: [Stereotype with word association](https://github.com/Yupei-Du/bias-in-wat)         |
| `llama_2.1_association.json`| This file contains word associations for LLaMA. Similar to human associations, this file is a nested dictionary where the outer key represents the cue word, and the corresponding value is an inner dictionary. The inner dictionary maps associated words (keys) to their frequencies (values).               |
|`mfd2.txt`| This file can be downloaded from [mfd](https://provalisresearch.com/products/content-analysis-software/wordstat-dictionary/moral-foundations-dictionary/) |
| `llama_2.1.json`| Llama word association result. The key represents the cue words, and the value consists of responses collected sequentially in a three-word manner.                    |
| `human_moral.json / llama_2.1_moral.json`         | These two files contain moral information for all cues for LLaMA and humans, respectively. The two files can be generated by running `getMoralValue.py`.       |
| `mag_words.json`| This file contains the words used for comparison between MAG and GMN.          |
| `selected_words.json`| This file contains 93 randomly selected verbs, adjectives, and nouns from the MFD.                |


## File: experiments.py
This file contains the key experiments from the paper. Run `-h` for more information about the included experiments.

## Prerequisites

Before running the scripts, make sure to install the required Python packages. Below is a list of all dependencies:

- `numpy`
- `pandas`
- `tqdm`
- `collections`
- `torch`
- `transformers`
- `huggingface_hub`
- `gensim`
- `scipy`
- `scipy.stats`
- `matplotlib`

### Installation

To install the required Python packages, run:

```bash
pip install -r requirements.txt
```

## Instruction

### Important Note:
- Please download the `emfd_scoring.csv` and `SWOW-EN.R100.csv`from the link described above before proceeding.

1. **Produce Human Association**:
   - Run `getHumanAssociation.py` to generate the file `human_association.json`.
   - **Note**: You might need to rename the file `SWOW-EN.R100_XXX.csv` (downloaded from [SWOW Project](https://smallworldofwords.org/en/project/research)) to `SWOW-EN.R100.csv`

2. **Produce LLaMA Associations**:
   - Run `produce.py` to generate the files `llama_2.1.json` and `llama_2.1_association.json`.
   - **Note**: This process requires significant computational power and is not recommended unless necessary.

3. **Generate Moral Information**:
   - Run `getMoralValue.py` to compute moral information based on human and LLM word associations.
   - The script will produce two files:
     - `human_moral.json`
     - `llama_2.1_moral.json`
   - These files will be saved in the `data` folder.

4. **Run Key Experiments**:
   - Perform key experiments described in the paper by running `experiments.py`.
   - For more details about the available experiments, use the following command:
     ```bash
     python experiments.py -h
     ```
